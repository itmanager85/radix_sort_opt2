<!DOCTYPE html>
<html>
<head></head>
<body>
    <canvas id="renderCanvas"></canvas>
    <style>
      body, #renderCanvas {
        margin: 0;
        width: 100%;
        height: 100vh;
      }
    </style>
  
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="radix_sort.js"></script> 
    <script>
        // Get the canvas DOM element
        var canvas = document.getElementById('renderCanvas');
        // Load the 3D engine
        async function createEngine() {
            const webGPUSupported = await BABYLON.WebGPUEngine.IsSupportedAsync;
            if (webGPUSupported) {
                const engine = new BABYLON.WebGPUEngine(canvas);
                await engine.initAsync();

                //document.write("<H1>webGPU is supported !!");
                return engine;
            }

            //document.write("<H1>webGPU not supported !!");
            //return new BABYLON.Engine(canvas, true); // WEBGL2
        }

        var engine = null;

        window.initFunction = async function() {
          engine = await createEngine();

          window.addEventListener('resize', function(){
              engine.resize();
          });

          engine.runRenderLoop(function () {});
        }

        initFunction().then(() => {

          // TEST HERE !!!
          //first execution more slower
          test(engine); 
                    
          const NUM_TEST_COUNT = 30; //1; //10;
          let avg_time = 0; 

          for (let i=0; i<NUM_TEST_COUNT; i++) {
            // 1.7 ms on average
            avg_time += test(engine); 
          }

          console.log(`Call to radix_sort took ${avg_time/NUM_TEST_COUNT} milliseconds (on average of ${NUM_TEST_COUNT} PASSES)`);
          
        });

      </script>
  </body>
  </html>